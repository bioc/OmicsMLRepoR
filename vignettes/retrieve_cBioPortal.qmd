---
title: "Retrieving Data from cBioPortal"
author:
  - Kaelyn Long
---

```{r setup, echo = FALSE}
suppressPackageStartupMessages({
    library(dplyr)
})
```

Retrieving specific samples from the cBioPortal API is very simple. First, we
load our curated metadata and set up the API.

```{r libraries}
if (!require("devtools"))
    install.packages("devtools")
devtools::install_github("shbrief/OmicsMLRepoR")

suppressPackageStartupMessages({
    library(OmicsMLRepoR)
    library(cBioPortalData)
})
```

```{r load}
# Get curated metadata
cbio <- getMetadata("cBioPortal")

# Set up cBioPortal API
cbio_api <- cBioPortal()
```

We can then retrieve our list of desired samples using any method. Here, we will
select 5 samples each from 5 studies by randomly selecting from the curated
metadata.

```{r random_samples}
# Select random sample that includes samples from 5 different studies
studies <- sample(unique(cbio$studyId), 5)
small_data <- cbio %>%
    filter(studyId %in% studies)
samples <- small_data %>%
    group_by(studyId) %>%
    sample_n(5)
```

Once we have our study and sample IDs, we can simply provide those to the
`cBioPortalData` function. In order to retrieve samples from multiple studies,
simply run `cBioPortalData` once for each study represented in the sample list.

```{r retrieve_data}
# Study 1
study_a <- studies[1]
study_a_samples <- samples %>%
    filter(studyId == study_a) %>%
    pull(sampleId)

study_a_data <- cBioPortalData(api = cbio_api,
                               by = "hugoGeneSymbol",
                               studyId = study_a,
                               sampleIds = study_a_samples,
                               genePanelId = "IMPACT341"
                               )
# Study 2
study_b <- studies[2]
study_b_samples <- samples %>%
    filter(studyId == study_b) %>%
    pull(sampleId)

study_b_data <- cBioPortalData(api = cbio_api,
                               by = "hugoGeneSymbol",
                               studyId = study_b,
                               sampleIds = study_b_samples,
                               genePanelId = "IMPACT341"
                               )
# Study 3
study_c <- studies[3]
study_c_samples <- samples %>%
    filter(studyId == study_c) %>%
    pull(sampleId)

study_c_data <- cBioPortalData(api = cbio_api,
                               by = "hugoGeneSymbol",
                               studyId = study_c,
                               sampleIds = study_c_samples,
                               genePanelId = "IMPACT341"
                               )
# Study 4
study_d <- studies[4]
study_d_samples <- samples %>%
    filter(studyId == study_d) %>%
    pull(sampleId)

study_d_data <- cBioPortalData(api = cbio_api,
                               by = "hugoGeneSymbol",
                               studyId = study_d,
                               sampleIds = study_d_samples,
                               genePanelId = "IMPACT341"
                               )
# Study 5
study_e <- studies[5]
study_e_samples <- samples %>%
    filter(studyId == study_e) %>%
    pull(sampleId)

study_e_data <- cBioPortalData(api = cbio_api,
                               by = "hugoGeneSymbol",
                               studyId = study_e,
                               sampleIds = study_e_samples,
                               genePanelId = "IMPACT341"
                               )
```